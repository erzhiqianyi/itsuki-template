---
import BaseLayout from '../layouts/BaseLayout.astro';
import { SITE_CONFIG, t } from '../data/site-config';

// 页面语言设置
const lang = 'ja';

// 模拟数据
const categories = [
    { id: "tech", label: { ja: "技術", en: "Tech" }, count: 12, color: "text-accent" },
    { id: "life", label: { ja: "生活", en: "Life" }, count: 8, color: "text-peach" },
    { id: "photo", label: { ja: "写真", en: "Photo" }, count: 5, color: "text-green" },
    { id: "study", label: { ja: "学習", en: "Study" }, count: 10, color: "text-pink" }
];

const allPosts = [
    {
        id: 1,
        title: { ja: "Astro 5.0 へのアップグレードガイド", en: "Astro 5.0 Upgrade Guide" },
        summary: { ja: "新機能と移行の注意点、そしてパフォーマンスの向上について...", en: "New features, migration tips, and performance improvements..." },
        date: "2024-12-20",
        tag: "Tech",
        category: "tech",
        words: 1200,
        cover: "https://images.unsplash.com/photo-1618477247222-acbdb0e159b3?q=80&w=800"
    },
    {
        id: 2,
        title: { ja: "東京の冬、カメラを持って", en: "Winter in Tokyo with Camera" },
        summary: { ja: "フィルム写真の魅力と、冬的色彩を捉えるための設定について。", en: "About the charm of film photography and settings for winter light." },
        date: "2024-12-15",
        tag: "Photo",
        category: "photo",
        words: 850,
        cover: "https://images.unsplash.com/photo-1503899036084-c55cdd92da26?q=80&w=800"
    },
    {
        id: 3,
        title: { ja: "効率的な日本語学習法", en: "Efficient Japanese Learning" },
        summary: { ja: "半年でN3からN2へ。私の学習ルーティンとおすすめ的教材を紹介します。", en: "From N3 to N2 in half a year. Introducing my routine and resources." },
        date: "2024-12-10",
        tag: "Study",
        category: "study",
        words: 2100,
        cover: "https://images.unsplash.com/photo-1528459801416-a7e99b0d6116?q=80&w=800"
    },
    {
        id: 4,
        title: { ja: "ミニマリストのデスクセットアップ", en: "Minimalist Desk Setup" },
        summary: { ja: "集中力を高めるための环境づくり。", en: "Creating an environment to improve focus." },
        date: "2024-12-05",
        tag: "Life",
        category: "life",
        words: 1500,
        cover: "https://images.unsplash.com/photo-1497215728101-856f4ea42174?q=80&w=800"
    }
];

const blogUI = {
    search: { ja: "検索", en: "Search" },
    categories: { ja: "カテゴリー", en: "Categories" },
    featured: { ja: "おすすめ", en: "Featured" },
    allPosts: { ja: "すべての記事", en: "All Posts" },
    wordCount: { ja: "文字", en: "words" },
    noResults: { ja: "記事が見つかりませんでした", en: "No results found" },
    readMore: { ja: "詳しく見る", en: "Read More" }
};
---

    <BaseLayout title={`Blog - ${SITE_CONFIG.brand.logo}`} lang={lang}>
<div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
<!-- 侧边栏 -->
<aside class="space-y-6 order-2 lg:order-1">
<!-- 搜索框 -->
<div class="bento-card rounded-3xl p-6">
<h3 class="text-xs font-bold uppercase tracking-widest text-[var(--accent)] mb-4 flex items-center gap-2">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
{blogUI.search[lang]}
</h3>
<input
type="text"
id="search-input"
class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-sm text-white focus:outline-none focus:border-[var(--accent)]/50 transition-all"
placeholder="Search posts..."
    />
    </div>

    <!-- 分类列表 -->
    <div class="bento-card rounded-3xl p-6">
<h3 class="text-xs font-bold uppercase tracking-widest text-[#a6e3a1] mb-4 flex items-center gap-2">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"/></svg>
{blogUI.categories[lang]}
</h3>
<div class="space-y-1">
    {categories.map(cat => (
            <button
                class="category-btn w-full flex justify-between items-center px-4 py-2 rounded-xl transition-all hover:bg-white/5 text-[var(--subtext)] group text-left"
        data-category={cat.id}
        >
        <span class={`text-sm font-semibold group-hover:text-white transition-colors`}>{cat.label[lang]}</span>
    <span class="text-[10px] font-mono opacity-40 group-hover:opacity-100">{cat.count}</span>
    </button>
))}
</div>
</div>

<!-- 推荐文章 -->
<div class="bento-card rounded-3xl p-6">
<h3 class="text-xs font-bold uppercase tracking-widest text-[#fab387] mb-4 flex items-center gap-2">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3z"/></svg>
{blogUI.featured[lang]}
</h3>
<div class="space-y-4">
    {allPosts.slice(0, 2).map(post => (
            <a href={`/blog/${post.id}`} class="flex gap-4 group">
<div class="w-14 h-14 rounded-2xl bg-[#181825] overflow-hidden shrink-0 border border-white/5">
<img src={post.cover} class="w-full h-full object-cover opacity-70 group-hover:opacity-100 transition duration-700" alt="">
    </div>
    <div class="min-w-0 flex flex-col justify-center">
<h4 class="text-[12px] font-bold text-white group-hover:text-[var(--accent)] transition truncate leading-tight mb-1">{post.title[lang]}</h4>
    <span class="text-[9px] font-mono text-gray-500">{post.date}</span>
    </div>
    </a>
))}
</div>
</div>
</aside>

<!-- 文章主体列表 -->
<div class="lg:col-span-3 space-y-6 order-1 lg:order-2">
<div class="flex justify-between items-center px-2">
<h2 class="text-xl font-bold text-white flex items-center gap-2">
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-[var(--accent)]"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>
{blogUI.allPosts[lang]}
</h2>
<div id="active-filter-tag" class="hidden text-[10px] font-mono bg-[var(--accent)]/10 text-[var(--accent)] px-2 py-1 rounded border border-[var(--accent)]/20 uppercase font-bold tracking-widest"></div>
    </div>

    <!-- 动态渲染容器 -->
    <div id="posts-container" class="space-y-6 min-h-[400px]">
    <!-- 由脚本填充 -->
    </div>

    <!-- 分页按钮 -->
    <div id="pagination-container" class="flex justify-center items-center gap-2 pt-12">
    <!-- 由脚本填充 -->
    </div>
    </div>
    </div>

    <!-- 交互脚本 -->
    <script is:inline define:vars={{ allPosts, lang, blogUI }}>
// 初始化全局状态
window.blogState = {
    currentPage: 1,
    currentCategory: null,
    searchQuery: "",
    postsPerPage: 2
};

function renderPosts() {
    const container = document.getElementById('posts-container');
    if (!container) return;

    const { currentPage, currentCategory, searchQuery, postsPerPage } = window.blogState;

    const filtered = allPosts.filter(post => {
        const matchesSearch = post.title[lang].toLowerCase().includes(searchQuery.toLowerCase()) ||
            post.summary[lang].toLowerCase().includes(searchQuery.toLowerCase());
        const matchesCategory = !currentCategory || post.category === currentCategory;
        return matchesSearch && matchesCategory;
    });

    const totalPages = Math.ceil(filtered.length / postsPerPage);
    const start = (currentPage - 1) * postsPerPage;
    const paginated = filtered.slice(start, start + postsPerPage);

    if (paginated.length === 0) {
        container.innerHTML = `<div class="py-20 text-center opacity-40"><p>${blogUI.noResults[lang]}</p></div>`;
        renderPagination(0);
        return;
    }

    container.innerHTML = paginated.map(post => `
                <a href="/blog/${post.id}" class="bento-card rounded-[2.5rem] overflow-hidden flex flex-col sm:flex-row group w-full items-stretch min-h-[280px]">
                    <!-- 修复图片：使用绝对定位容器并确保父级拉伸 -->
                    <div class="sm:w-80 w-full min-h-[240px] sm:min-h-full shrink-0 relative border-r border-white/5 overflow-hidden">
                        <img 
                            src="${post.cover}" 
                            class="absolute inset-0 w-full h-full object-cover opacity-80 group-hover:scale-105 group-hover:opacity-100 transition duration-[1.5s]" 
                            alt="${post.title[lang]}"
                        >
                    </div>
                    <div class="p-8 md:p-10 flex flex-col justify-between flex-1 text-left bg-gradient-to-br from-white/[0.02] to-transparent">
                        <div>
                            <div class="flex items-center gap-4 mb-4 text-[10px] font-mono font-bold uppercase tracking-wider">
                                <span class="text-[var(--accent)] bg-[var(--accent)]/10 px-2 py-0.5 rounded border border-[var(--accent)]/20">${post.tag}</span>
                                <span class="text-gray-500">${post.date}</span>
                            </div>
                            <h3 class="text-2xl font-bold text-white mb-4 group-hover:text-[var(--accent)] transition duration-300 leading-tight">
                                ${post.title[lang]}
                            </h3>
                            <p class="text-[14px] text-[var(--subtext)] leading-relaxed line-clamp-3">
                                ${post.summary[lang]}
                            </p>
                        </div>
                        <div class="mt-8 pt-6 border-t border-white/5 flex justify-between items-center text-[10px] font-mono text-gray-500 uppercase tracking-widest">
                            <span class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="21" x2="3" y1="6"/><line x1="15" x2="3" y1="12"/><line x1="17" x2="3" y1="18"/></svg>
                                ${post.words} ${blogUI.wordCount[lang]}
                            </span>
                            <span class="text-[var(--accent)] font-black group-hover:translate-x-2 transition-transform duration-300 flex items-center gap-2">
                                ${blogUI.readMore[lang]}
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                            </span>
                        </div>
                    </div>
                </a>
            `).join('');

    renderPagination(totalPages);
}

function renderPagination(totalPages) {
    const container = document.getElementById('pagination-container');
    if (!container) return;

    if (totalPages <= 1) {
        container.innerHTML = '';
        return;
    }

    const { currentPage } = window.blogState;

    let html = `
                <button class="p-3 text-[var(--subtext)] hover:text-white transition ${currentPage === 1 ? 'opacity-20 cursor-not-allowed' : ''}" onclick="window.setPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                </button>
            `;

    for (let i = 1; i <= totalPages; i++) {
        html += `
                    <button 
                        class="w-12 h-12 rounded-2xl border transition-all duration-300 ${i === currentPage ? 'bg-[var(--accent)] text-[#1e1e2e] border-[var(--accent)] shadow-lg shadow-[var(--accent)]/20 scale-110 font-black' : 'border-white/5 text-[var(--subtext)] hover:border-white/20 hover:bg-white/5'}"
                        onclick="window.setPage(${i})"
                    >${i}</button>
                `;
    }

    html += `
                <button class="p-3 text-[var(--subtext)] hover:text-white transition ${currentPage === totalPages ? 'opacity-20 cursor-not-allowed' : ''}" onclick="window.setPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                </button>
            `;
    container.innerHTML = html;
}

window.setPage = function(page) {
    window.blogState.currentPage = page;
    renderPosts();
    window.scrollTo({ top: 0, behavior: 'smooth' });
};

document.addEventListener('DOMContentLoaded', () => {
    const searchInput = document.getElementById('search-input');
    if (searchInput) {
        searchInput.addEventListener('input', (e) => {
            window.blogState.searchQuery = e.target.value;
            window.blogState.currentPage = 1;
            renderPosts();
        });
    }

    document.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const cat = btn.dataset.category;
            window.blogState.currentCategory = window.blogState.currentCategory === cat ? null : cat;

            document.querySelectorAll('.category-btn').forEach(b => {
                if (b.dataset.category === window.blogState.currentCategory) {
                    b.classList.add('bg-white/10', 'text-white');
                } else {
                    b.classList.remove('bg-white/10', 'text-white');
                }
            });

            const tag = document.getElementById('active-filter-tag');
            if (tag) {
                if (window.blogState.currentCategory) {
                    tag.innerText = window.blogState.currentCategory;
                    tag.classList.remove('hidden');
                } else {
                    tag.classList.add('hidden');
                }
            }

            window.blogState.currentPage = 1;
            renderPosts();
        });
    });

    renderPosts();
});
</script>
</BaseLayout>